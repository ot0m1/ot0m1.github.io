<p><a href="http://d.hatena.ne.jp/keyword/Sinatra">Sinatra</a>アプリでのデータ保存先をデータベースに変えるため、<a href="https://github.com/ged/ruby-pg">ruby-pg</a>を触ってみる。 簡単な Ruby スクリプトを書いて「書き込み」「読み取り」「編集」「削除」の一連の操作ができるようにする。</p>

<!-- more -->

<p>まずはTableの作成。</p>

<ul>
  <li>Ruby側</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'pg'</span>

<span class="n">connection</span> <span class="o">=</span> <span class="no">PG</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span> <span class="ss">dbname: </span><span class="s1">'postgres'</span> <span class="p">)</span>
<span class="n">connection</span><span class="p">.</span><span class="nf">exec</span><span class="p">(</span><span class="s1">'CREATE TABLE sinatra_table (id INTEGER PRIMARY KEY, title TEXT NOT NULL, body TEXT)'</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>PostgreSQL側</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-&gt;</span> <span class="o">%</span> <span class="n">ruby</span> <span class="n">test</span><span class="p">.</span><span class="n">rb</span> 
<span class="o">-&gt;</span> <span class="o">%</span> <span class="n">psql</span> <span class="o">-</span><span class="n">U</span> <span class="n">aksk</span> <span class="n">postgres</span>
<span class="n">psql</span> <span class="p">(</span><span class="mi">13</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
<span class="k">Type</span> <span class="nv">"help"</span> <span class="k">for</span> <span class="n">help</span><span class="p">.</span>

<span class="n">postgres</span><span class="o">=#</span> <span class="err">\</span><span class="n">d</span>
           <span class="n">List</span> <span class="k">of</span> <span class="n">relations</span>
 <span class="k">Schema</span> <span class="o">|</span>     <span class="n">Name</span>      <span class="o">|</span> <span class="k">Type</span>  <span class="o">|</span> <span class="k">Owner</span>
<span class="c1">--------+---------------+-------+-------</span>
 <span class="k">public</span> <span class="o">|</span> <span class="n">sinatra_table</span> <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="n">aksk</span>
<span class="p">(</span><span class="mi">1</span> <span class="k">row</span><span class="p">)</span>

<span class="n">postgres</span><span class="o">=#</span>
</code></pre></div></div>

<p>Tableできた。が、これって<code class="language-plaintext highlighter-rouge">postgres</code>っていうデータベースが存在することが予め分かっているのでコネクションを張れているが、自作の<a href="http://d.hatena.ne.jp/keyword/Sinatra">Sinatra</a>のWebアプリケーションをcloneしてもらって他の人のパソコン上で動かすときはデータベース名どうやって決めればいいのだろうか？</p>

<p><code class="language-plaintext highlighter-rouge">PG::Connection.new(host, port, options, tty, dbname, user, password)</code> これで任意のホストへ接続できるので、自分が契約している<a href="http://d.hatena.ne.jp/keyword/VPN">VPN</a>へコネクション張れば誰のパソコン上でも予めわかっているデータベース名で接続できるけど、そういうことじゃないよな〜…。</p>

