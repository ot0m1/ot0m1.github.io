<p>1年以上ぶりの記事ですね。</p>

<p>去年の12月から<a href="https://bootcamp.fjord.jp">フィヨルドブートキャンプ</a>に通っており、もう1年以上経ちます。 途中半年以上全然プ<a href="http://d.hatena.ne.jp/keyword/%A5%E9%A5%AF">ラク</a>ティスをやっていないに等しいような時期があったのですが、ここ2ヶ月くらいはなんとか勉強が習慣化してきたようで連日のようにプ<a href="http://d.hatena.ne.jp/keyword/%A5%E9%A5%AF">ラク</a>ティスを進めることができている状態です。</p>

<p><a href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%A3%A5%E8%A5%EB%A5%C9">フィヨルド</a>ブートキャンプではプ<a href="http://d.hatena.ne.jp/keyword/%A5%E9%A5%AF">ラク</a>ティスをやった日は必ず日報を書くようになっており、僕も必ず書いています。 その日報をブログにも書いて勉強の過程を公開しようしようと思いつつやれておらず、また過去にさかのぼってブログ書くのもしんどいので中途半端で唐突な始まりですが今日から本気出す。</p>

<!-- more -->

<p>作ったアプリケーションはこれ。</p>

<iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2FAkkkky%2Ffrankly-note" title="Akkkky/frankly-note" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe>
<p><cite class="hatena-citation"><a href="https://github.com/Akkkky/frankly-note">github.com</a></cite></p>

<h2 id="rest-のリソース設計は思っているより全然難しい">REST のリソース設計は思っているより全然難しい</h2>

<p>提出物を作成した段階ではわりとスムーズに進められたな〜とか思っていたが、レビューをいただくと色々考慮漏れがあることが分かってきた。</p>

<ul>
  <li>リソース名の単数形と複数形を統一する</li>
  <li><a href="http://d.hatena.ne.jp/keyword/URI">URI</a> の構造を統一する</li>
  <li>実際にブラウザからアクセスするときの URL を考える
    <ul>
      <li>ブラウザからアクセスしたときに分かりにくいリソース表現になっていないか</li>
    </ul>
  </li>
  <li>実際にブラウザからアクセスするときに区別できない URL になっていないか
    <ul>
      <li>異なるリソースを同じ URL で表現しようとしていないか</li>
      <li>安易に id だけでリソースを区別しようとするとブラウザから見たときに人間が区別できない</li>
    </ul>
  </li>
</ul>

<h2 id="ds_store-に困らせられた">.DS_Store に困らせられた</h2>

<p>データベースで管理せずにファイルにデータを保存する関係でファイル操作を行うためか、今までは特に気にしていなかった .DS_Store ファイルがいつの間にかできており、うっかりリモー<a href="http://d.hatena.ne.jp/keyword/%A5%C8%A5%EA%A5%DD%A5%B8">トリポジ</a>トリへ追加してしまうことがあった。</p>

<p>今までの経験から安易に <code class="language-plaintext highlighter-rouge">rm</code> したり、リモー<a href="http://d.hatena.ne.jp/keyword/%A5%C8%A5%EA%A5%DD%A5%B8">トリポジ</a>トリ側で消しちゃうと差分に困るのでしっかり <code class="language-plaintext highlighter-rouge">git rm</code> できたのは良かった。 .gitignore に追記することでリモー<a href="http://d.hatena.ne.jp/keyword/%A5%C8%A5%EA%A5%DD%A5%B8">トリポジ</a>トリに追加されることは回避できる。</p>

<h2 id="空のディレクトリは-git-add-できない">空の<a href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リは <code class="language-plaintext highlighter-rouge">git add</code> できない</h2>

<p>メモを格納する空の<a href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを作成していたのだが、リモー<a href="http://d.hatena.ne.jp/keyword/%A5%C8%A5%EA%A5%DD%A5%B8">トリポジ</a>トリ側に反映せずにちょっと困った。</p>

<p>そのような場合は .gitkeep ファイルを置いたりするらしい。<a href="https://qiita.com/tommy_aka_jps/items/b2ae85cbeab77e12a925">https://qiita.com/tommy_aka_jps/items/b2ae85cbeab77e12a925</a></p>

<p>これで無事にリモー<a href="http://d.hatena.ne.jp/keyword/%A5%C8%A5%EA%A5%DD%A5%B8">トリポジ</a>トリへ空<a href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを追加できた。</p>

<h2 id="rubocop-の言うことをちゃんと聞く">Rubocop の言うことをちゃんと聞く</h2>

<p>提出直前になって rubocop を通してみたときにセキュリティ関連の警告が出たが、これはデータベースを利用せずにメモをファイルで管理しているために表示されるものであり、今回の実装ではしょうがないと思いこんでいた。</p>

<p>のでそのまま提出しようとしたが、ファイルを読み込むだけで警告が出るはずないだろう、自分よりはるかに経験豊富な人達が作ってくれているライブラリなのに安易にしょうがないで片付けるのは早とちりなのではないかと思い、ちゃんと警告文と向き合った。</p>

<p>表示されていた警告文は以下の2つ。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lib</span><span class="o">/</span><span class="n">crud_controller</span><span class="p">.</span><span class="nf">rb</span><span class="p">:</span><span class="mi">62</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span> <span class="no">C</span><span class="p">:</span> <span class="no">Security</span><span class="o">/</span><span class="no">Open</span><span class="p">:</span> <span class="no">The</span> <span class="n">use</span> <span class="n">of</span> <span class="no">Kernel</span><span class="c1">#open is a serious security risk.</span>
  <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="o">^^^^</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lib</span><span class="o">/</span><span class="n">crud_controller</span><span class="p">.</span><span class="nf">rb</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span> <span class="no">C</span><span class="p">:</span> <span class="p">[</span><span class="no">Correctable</span><span class="p">]</span> <span class="no">Security</span><span class="o">/</span><span class="no">JSONLoad</span><span class="p">:</span> <span class="no">Prefer</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span> <span class="n">over</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">load</span><span class="p">.</span>
      <span class="nf">json_object</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
                         <span class="o">^^^^</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">open</code> メソッドはOSコマンドインジェクションの<a href="http://d.hatena.ne.jp/keyword/%C0%C8%BC%E5%C0%AD">脆弱性</a>があるらしい<a href="https://www.lanches.co.jp/blog/5996">https://www.lanches.co.jp/blog/5996</a><code class="language-plaintext highlighter-rouge">File.open</code> を使うことで存在しないパスの場合はエラーになるのでOSコマンドインジェクション疑われるようなファイルのパス以外の文字列が渡されてもエラーにして回避できる。</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">JSON.load</code> で直接ファイルを開かない<code class="language-plaintext highlighter-rouge">JSON.parse</code>を推奨される理由が自分の検索能力では調べきれなかったが、なるべくファイルは開かないに越したことはないからなかと推測した。 そのため<code class="language-plaintext highlighter-rouge">File.open</code> で読み込んだファイルオブジェクトを <code class="language-plaintext highlighter-rouge">read</code> して文字列を渡して <code class="language-plaintext highlighter-rouge">parse</code> してもらうように変更した。</p>

    <p>json_object = JSON.parse(json_file.read)</p>
  </li>
</ul>

<p>上記を行って警告は全解消できた。 と同時に、これ実務でもし修正せずにそのまま本番環境に適用させたら<a href="http://d.hatena.ne.jp/keyword/%C0%C8%BC%E5%C0%AD">脆弱性</a>を作ったことになるなぁと怖くなった。</p>

<p>警告文を流し読みせず、しっかり向き合うように改めて思えるいい機会だった。</p>

<h1 id="感想など">感想など</h1>

<p><a href="http://d.hatena.ne.jp/keyword/Sinatra">Sinatra</a> のプ<a href="http://d.hatena.ne.jp/keyword/%A5%E9%A5%AF">ラク</a>ティスの提出物を完成させられた。</p>

<p>ところどころハマったところはあったが、かつてのように何が分からないかも分からないのでハマりを解消する手がかりさえ全く不明、というような頭を抱えるようなドハマリはなく、自分で調べて解消できるようになっていたので成長しているのかなと感じた。</p>

